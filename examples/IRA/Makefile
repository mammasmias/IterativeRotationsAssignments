#
# Fortran/C compilers
#
FCOMP = gfortran
CCOMP = gcc

#
# compilation flags
#
FFLAGS = -fbounds-check
CFLAGS =

#
# the needed paths:
#

# this path:
SRC := $(abspath $(dir $(lastword $(MAKEFILE_LIST))))

# ira/src path:
SRCDIR = $(realpath $(SRC)/../../src)

# library dir (path to libira.a or libira.so)
LIBDIR = $(realpath $(SRC)/../../lib)

# include dir (path to .mod files)
INCDIR = $(realpath $(SRC)/../../include)

# interface dir (path to iralib_interf.h)
INTERFDIR = $(realpath $(SRC)/../../interface)

MOD = -I$(INCDIR)

#
# specify link to libira
#
SHLIB = -L$(LIBDIR) -lira
#
# set runpath
#
SHLIB += -Wl,-rpath,$(LIBDIR)

#
# when linking to static library libira.a add these:
#
SHLIB += #-lm -lgfortran -llapack

# Produced filenames
#
F_PROG = $(SRC)/f90_program.x
C_PROG = $(SRC)/c_program.x


#=======================
# program files
#
fprog := $(SRC)/f90_program.f90

cprog := $(SRC)/c_program.c


default: msg

all : f90 cprog


f90: $(F_PROG)
cprog: $(C_PROG)



#====
# Compile the f90 executable
#====
$(F_PROG): $(fprog)
	$(FCOMP) $(FFLAGS) $(MOD) $^ -o $@ $(SHLIB)
	@echo ' >> Fortran program compiled successfully: $(F_PROG)'
	@echo ' >> Launch as: ./$(F_PROG) < example_inputs/input1.xyz'

#====
# Compile the C executable
#====
$(C_PROG): $(cprog)
	$(CCOMP) -I$(INTERFDIR) $(CFLAGS) $(MOD) -o $@ $^ $(SHLIB)
	@echo ' >> C program compiled successfully: $(C_PROG)'
	@echo ' >> Launch as: ./$(C_PROG)  example_inputs/input1.xyz'


msg:
	@echo 'Use one of the following:'
	@echo ''
	@echo ' make f90     -> compiles the f90 example program $(F_PROG) executable'
	@echo ' make cprog   -> compiles the C example program $(C_PROG)'
	@echo ' make all     -> all of the above'
	@echo ''
	@echo ' make clean   -> remove all files generated by make'
	@echo ''
	@echo 'Quitting.'




clean:
	rm -rf $(F_PROG)  $(C_PROG)



