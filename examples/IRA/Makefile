#
# Fortran compiler
#
FCOMP = gfortran
CCOMP=gcc

#
# compilation flags
#
FFLAGS = -fdefault-real-8 -fbounds-check
CFLAGS =

SRC := $(abspath $(dir $(lastword $(MAKEFILE_LIST))))
SRCDIR = $(realpath $(SRC)/../../src)
LIBDIR = $(realpath $(SRC)/../../lib)
INTERFDIR = $(realpath $(SRC)/../../interface)
OBJ = $(SRC)/Obj

MOD = # -I$(OBJ) -J$(OBJ)

#
# path to src/libira
#
SHLIB = -L$(LIBDIR) -lira -Wl,-rpath,$(LIBDIR)

#
# when linking to static library libira.a define these:
#
LIBS= #-lm -lgfortran -llapack

# Produced filenames
#
IRAUNI_X = $(SRC)/f90_program.x
C_PROG = $(SRC)/c_program.x


#=======================
# object files
#
f_uni := $(SRC)/f90_program.f90
o_uni := $(patsubst $(SRC)%, $(OBJ)%, $(f_uni:%.f90=%.o))

cprog := $(SRC)/c_program.c


default: msg

all : f90 cprog

$(OBJ)%.o: $(SRC)/%.f90
	$(FCOMP) $(FFLAGS) $(MOD) -c $< -o $@


f90: $(OBJ) $(IRAUNI_X)
cprog: $(OBJ) $(C_PROG)

#
# object folder
#
$(OBJ):
	@if [ ! -d $(OBJ) ]; then mkdir $(OBJ) ; fi



#====
# Compile the f90 executable
#====
$(IRAUNI_X): $(o_uni)
	$(FCOMP) $(FFLAGS) $(MOD) $^ -o $@ $(SHLIB) $(LIBS)

#====
# Compile the C executable
#====
$(C_PROG): $(cprog)
	$(CCOMP) -I$(INTERFDIR) $(CFLAGS) $(MOD) -o $@ $^ $(SHLIB) $(LIBS)


msg:
	@echo 'Use one of the following:'
	@echo ''
	@echo ' make f90     -> compiles the f90 example program $(IRAUNI_X) executable'
	@echo ' make cprog   -> compiles the C example program $(C_PROG)'
	@echo ' make all     -> all of the above'
	@echo ''
	@echo ' make clean   -> remove all files generated by make'
	@echo ''
	@echo 'Quitting.'




clean:
	rm -rf $(IRAUNI_X)  $(C_PROG)
	rm -rf $(OBJ)



