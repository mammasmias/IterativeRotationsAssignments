#
# Fortran and C compilers
#
F90 = gfortran
CC=gcc


#
# compilation flags
#
# FFLAGS = -fdefault-real-8 -fcheck=bounds
FFLAGS = -fcheck=bounds
CFLAGS =

#
# directories:
#

# this path
SRC := $(abspath $(dir $(lastword $(MAKEFILE_LIST))))

# ira/src path:
SRCDIR := $(realpath $(SRC)/../../src)

# library dir (path to libira.a or libira.so)
LIBDIR := $(realpath $(SRC)/../../lib)

# include dir (path to .mod files)
INCDIR := $(realpath $(SRC)/../../include)

# interface dir (path to iralib_interf.h)
INTERFDIR = $(realpath $(SRC)/../../interface)

MOD = -I$(INCDIR)
#
# include directory of header for C program
#
C_INCLUDE = -I$(INTERFDIR)



#
# specify link to libira
#
SHLIB = -L$(LIBDIR) -lira
#
# set runpath
#
SHLIB += -Wl,-rpath,$(LIBDIR)


## When using the static library: uncomment the following:
##
SHLIB += #-lm -lgfortran -llapack



#
# Produced filenames
#
F_PROG = $(SRC)/f90_program.x
C_PROG = $(SRC)/c_program.x




#=======================
# object files of programs
#
fprog := $(SRC)/f90_program.f90
cprog := $(SRC)/c_program.c
#======================


default: msg

all : f90 cprog

f90: $(F_PROG)
cprog: $(C_PROG)

#====
# Compile the f90 executable
#====
$(F_PROG): $(fprog)
	$(F90) $(FFLAGS) $(MOD) -o $@ $^ $(SHLIB)
	@echo ' >> Fortran program compiled successfully: $(F_PROG)'
	@echo ' >> Launch as: $(F_PROG) < example_inputs/Th.xyz'

#====
# Compile the C executable
#====
$(C_PROG): $(cprog)
	$(CC) $(CFLAGS) $(C_INCLUDE) $(MOD) -o $@ $^ $(SHLIB)
	@echo ' >> C program compiled successfully: $(C_PROG)'
	@echo ' >> Launch as: $(C_PROG) < example_inputs/Th.xyz'


msg:
	@echo 'Use one of the following:'
	@echo ''
	@echo ' make f90     -> compiles the f90 example program $(F_PROG) executable'
	@echo ' make cprog   -> compiles the C example program $(C_PROG)'
	@echo ' make all     -> all of the above'
	@echo ''
	@echo ' make clean   -> remove all files generated by make'
	@echo ''
	@echo 'Quitting.'




clean:
	rm -rf $(F_PROG) $(C_PROG)



